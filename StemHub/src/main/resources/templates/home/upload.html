<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tải lên tài liệu - STEMIND</title>
    <link rel="icon" type="image/png" th:href="@{/images/Symbol.png}">
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link th:href="@{/style/base/base1.css}" rel="stylesheet">
    <link th:href="@{/style/base/base2.css}" rel="stylesheet">
    <link th:href="@{/style/base/header.css}" rel="stylesheet">
    <link th:href="@{/style/home/upload.css}" rel="stylesheet">
</head>

<body class="d-flex flex-column min-vh-100">
    <!-- Header -->
    <div th:replace="~{base/header :: header}"></div>

    <!-- Main Content -->
    <main id="main-content" class="flex-grow-1 page-transition">
        <div class="container mt-4">
            <div class="upload-container">
                <!-- Header -->
                <div class="upload-header">
                    <h1><i class="fas fa-cloud-upload-alt me-3"></i>Tải lên tài liệu</h1>
                    <p class="lead mb-0">Chia sẻ kiến thức với cộng đồng STEMIND</p>
                </div>

                <!-- Messages -->
                <div th:if="${message}" class="alert" th:classappend="${messageType == 'success'} ? 'alert-success' : 'alert-danger'" role="alert">
                    <i class="fas" th:classappend="${messageType == 'success'} ? 'fa-check-circle' : 'fa-exclamation-triangle'"></i>
                    <span th:text="${message}"></span>
                </div>

                <!-- Upload Tips -->
                <div class="upload-tips">
                    <h5><i class="fas fa-lightbulb me-2"></i>Mẹo tải lên hiệu quả</h5>
                    <ul class="tips-list">
                        <li>Đặt tiêu đề rõ ràng, dễ tìm kiếm</li>
                        <li>Chọn danh mục phù hợp với nội dung</li>
                        <li>Viết mô tả chi tiết để người dùng hiểu rõ nội dung</li>
                        <li>Sử dụng hình thu nhỏ hấp dẫn để thu hút người xem</li>
                    </ul>
                </div>

                <!-- Upload Form -->
                <form method="post" th:action="@{/document/upload}" enctype="multipart/form-data" class="upload-form" id="uploadForm">
                    <!-- File Upload Section -->
                    <div class="form-section">
                        <h5><i class="fas fa-file-upload me-2"></i>Chọn tệp tài liệu</h5>

                        <div class="drag-drop-area" id="dragDropArea">
                <input type="file" class="file-input-hidden" id="fileInput" name="file"
                    accept=".pdf,application/pdf" required>
                            <div class="upload-content">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <h4>Kéo thả tệp vào đây hoặc click để chọn</h4>
                                <p class="text-muted">Chỉ hỗ trợ: PDF (.pdf)</p>
                                <p class="text-muted">Kích thước tối đa: 500MB</p>
                            </div>
                        </div>

                        <div class="selected-file" id="selectedFile" style="display: none;">
                            <div class="file-info">
                                <i class="fas fa-file file-icon"></i>
                                <div>
                                    <div class="file-name fw-bold"></div>
                                    <div class="file-size text-muted"></div>
                                </div>
                            </div>
                        </div>

                        <div class="progress" id="progressBar" style="display: none; height: 25px; margin-top: 10px;">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Document Information -->
                    <div class="form-section">
                        <h5><i class="fas fa-info-circle me-2"></i>Thông tin tài liệu</h5>

                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="title" class="form-label">Tiêu đề <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="title" name="title" placeholder="Nhập tiêu đề tài liệu" required>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="category" class="form-label">Danh mục</label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="" disabled selected>Chọn danh mục</option>
                                    <option th:each="cat : ${T(com.team7.StemHub.model.enums.Category).values()}"
                                            th:value="${cat.name()}"
                                            th:text="${cat.displayName}">Category</option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="courseName" class="form-label">Môn học/Khoá học <span class="text-danger">*</span></label><!-- Changed to standard dropdown -->
                                <select class="form-select" id="courseName" name="courseName" required>
                                    <option value="" disabled selected>Chọn môn học/khoá học</option>
                                    <option th:each="c : ${courses}"
                                            th:value="${c.courseName}"
                                            th:text="${c.courseName}">
                                        Course Name
                                    </option>
                                </select>
                                <small class="text-muted">Chọn một môn học/khoá học từ danh sách</small>
                            </div>

                <input type="hidden" id="authorId" name="authorId" th:value="${userId}"
                                   sec:authorize="isAuthenticated()">
                            <div class="mb-3">
                                <label for="description" class="form-label">Mô tả</label>
                                <textarea class="form-control" id="description" name="description" rows="4" placeholder="Mô tả chi tiết về tài liệu của bạn..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Thumbnail Upload -->
                    <div class="form-section">
                        <h5><i class="fas fa-image me-2"></i>Hình thu nhỏ (Tùy chọn)</h5>

                        <div class="thumbnail-upload">
                            <input type="file" class="file-input-hidden" id="thumbnailInput" name="thumbnail" accept="image/*">
                            <label for="thumbnailInput" class="thumbnail-label">
                                <i class="fas fa-plus"></i>
                                <span>Thêm hình thu nhỏ</span>
                            </label>
                            <div class="thumbnail-preview" id="thumbnailPreview" style="display: none;">
                                <img src="" alt="Thumbnail preview">
                                <button type="button" class="btn-remove-thumbnail" id="removeThumbnail">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="window.location.href='/'">
                            <i class="fas fa-times me-2"></i>Hủy
                        </button>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-upload me-2"></i>Tải lên
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <div th:replace="~{base/footer :: footer}"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/script/base/base.js}"></script>
    <script th:src="@{/script/base/footer.js}"></script>
    <script th:src="@{/script/home/upload.js}"></script>
</body>
</html>
