<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>STEMIND - Chia sẻ tài liệu STEM</title>
    <link rel="icon" type="image/png" th:href="@{/images/Symbol.png}">
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link th:href="@{/style/base/base1.css}" rel="stylesheet">
    <link th:href="@{/style/base/base2.css}" rel="stylesheet">
    <link th:href="@{/style/base/header.css}" rel="stylesheet">
    <link th:href="@{/style/home/home.css}" rel="stylesheet">
</head>

<body class="d-flex flex-column min-vh-100">
    <!-- Header -->
    <div th:replace="~{base/header :: header}"></div>

    <!-- Main Content -->
    <main id="main-content" class="flex-grow-1 page-transition">
        <!-- Toast Notifications Container -->
        <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
            <div th:if="${message}" class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header" th:classappend="${messageType == 'success'} ? 'bg-success text-white' : 'bg-danger text-white'">
                    <i class="fas" th:classappend="${messageType == 'success'} ? 'fa-check-circle' : 'fa-exclamation-triangle'"></i>
                    <strong class="me-auto" th:text="${messageType == 'success'} ? 'Thành công' : 'Lỗi'"></strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body" th:text="${message}"></div>
            </div>
        </div>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="container">
                <div class="hero-content text-center">
                    <img th:src="@{/images/Logo_noback_white.png}" alt="Logo" class="logo-image" style="width: 220px; height: 200px; margin-bottom: 20px; margin-top: 0px;">
                    <p class="hero-subtitle">STEMIND là nền tảng trực tuyến tích hợp AI được thiết kế để giúp giáo viên nhanh chóng thiết kế bài giảng STEM, tìm kiếm tài liệu học tập phù hợp và tổ chức các hoạt động. Với giao diện thân thiện, tiết kiệm thời gian, nâng cao chất lượng giảng dạy và kết nối cộng đồng.</p>
                    <div class="hero-stats">
                        <div class="hero-stat">
                            <span class="hero-stat-number" th:text="${documentCount} ?: '50+'">50+</span>
                            <span class="hero-stat-label">Tài liệu chất lượng</span>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-number" th:text="${userCount} ?: '100+'">100+</span>
                            <span class="hero-stat-label">Giáo viên tham gia</span>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-number" th:text="${courseCount} ?: '500+'">500+</span>
                            <span class="hero-stat-label">Bài giảng được tạo</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Featured Files Section -->
        <section class="featured-section">
            <div class="container">
                <div class="d-flex align-items-center justify-content-between mb-4">
                    <h2 class="section-title mb-0">
                        <i class="fas fa-star me-2"></i>Tài liệu nổi bật
                    </h2>
                    <small class="text-muted">
                        <i class="fas fa-arrow-right me-1"></i>Kéo để xem thêm
                    </small>
                </div>

                <div class="featured-scroll-container" th:if="${topDocuments != null and !#lists.isEmpty(topDocuments)}">
                    <div class="featured-grid">
                        <article class="featured-card" th:each="doc : ${topDocuments}">
                            <a th:href="@{/document/detail/{id}(id=${doc.id})}" class="text-decoration-none">
                                <div class="featured-card-image">
                                    <!-- Use thumbnailPath if available, otherwise default image -->
                                    <img th:src="${doc.thumbnailPath != null ? doc.thumbnailPath : '/images/default-thumbnail.png'}" th:alt="${doc.title}" loading="lazy">
                                    <div class="featured-card-overlay">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="featured-card-badge">
                                        <span class="badge bg-warning">
                                            <i class="fas fa-star me-1"></i>Nổi bật
                                        </span>
                                    </div>
                                </div>
                                <div class="featured-card-content">
                                    <h3 class="featured-card-title" th:text="${doc.title}">Tiêu đề</h3>
                                    <p class="featured-card-description" th:text="${#strings.abbreviate(doc.description, 80)}">Mô tả</p>
                                    <div class="featured-card-author">
                                        <i class="fas fa-user"></i>
                                        <span th:text="${doc.author != null ? doc.author.username : 'Anonymous'}">Tác giả</span>
                                    </div>
                                    <div class="featured-card-footer">
                                        <div class="featured-card-info">
                                            <span class="badge bg-primary me-1" th:text="${doc.category}">Category</span>
                                            <small class="text-muted">
                                                <i class="fas fa-download me-1"></i>
                                                <span th:text="${doc.downloadCount}">0 lượt tải</span><span> lượt tải</span>
                                            </small>
                                        </div>
<!--                                        <div class="featured-card-price">-->
<!--                                            <span class="badge bg-success">Miễn phí</span>-->
<!--                                        </div>-->
                                    </div>
                                </div>
                            </a>
                        </article>
                    </div>
                </div>

                <!-- Empty state for top documents -->
                <div th:if="${topDocuments == null or #lists.isEmpty(topDocuments)}" class="empty-state text-center py-5">
                    <i class="fas fa-star fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">Chưa có tài liệu nổi bật</h5>
                    <p class="text-muted mb-3">Các tài liệu được nhiều người quan tâm sẽ xuất hiện ở đây</p>
                    <a th:href="@{/search}" class="btn btn-outline-primary">
                        <i class="fas fa-search me-2"></i>Khám phá tài liệu
                    </a>
                </div>
            </div>
        </section>

        <!-- Recent Files Section -->
        <section class="recent-section">
            <div class="container">
                <div class="row g-4">
                    <div class="col-lg-8">
                        <h2 class="section-title text-start">
                            <i class="fas fa-clock me-2"></i>Tài liệu mới nhất
                        </h2>
                        <div class="newest-documents-container">
                            <article class="recent-item" th:each="doc : ${newestDocuments}">
                                <a th:href="@{/document/detail/{id}(id=${doc.id})}" class="text-decoration-none d-flex align-items-center gap-3 w-100">
                                    <div class="recent-item-image">
                                        <!-- Use thumbnailPath if available, otherwise default image -->
                                        <img th:src="${doc.thumbnailPath != null ? doc.thumbnailPath : '/images/default-thumbnail.png'}" th:alt="${doc.title}" loading="lazy">
                                        <div class="recent-item-overlay">
                                            <i class="fas fa-eye"></i>
                                        </div>
                                    </div>
                                    <div class="recent-item-content flex-grow-1">
                                        <h4 class="recent-item-title" th:text="${doc.title}">Tiêu đề</h4>
                                        <p class="recent-item-description text-muted" th:text="${#strings.abbreviate(doc.description, 100)}">Mô tả ngắn...</p>
                                        <div class="recent-item-meta d-flex align-items-center justify-content-between">
                                            <div class="recent-item-author">
                                                <i class="fas fa-user me-1"></i>
                                                <span th:text="${doc.author != null ? doc.author.username : 'Anonymous'}">Tác giả</span>
                                            </div>
                                            <div class="recent-item-stats">
                                                <span class="badge bg-primary me-2" th:text="${doc.category}">Category</span>
                                                <small class="text-muted" th:if="${doc.createAt != null}">
                                                    <i class="fas fa-calendar me-1"></i>
                                                    <span th:text="${#temporals.format(doc.createAt, 'dd/MM/yyyy')}">Ngày tạo</span>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </article>
                        </div>

                        <!-- Empty state if no documents -->
                        <div th:if="${newestDocuments == null or #lists.isEmpty(newestDocuments)}" class="empty-state text-center py-5">
                            <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">Chưa có tài liệu nào</h5>
                            <p class="text-muted mb-3">Hãy là người đầu tiên tải lên tài liệu!</p>
                            <a th:href="@{/document/upload}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Tải lên tài liệu
                            </a>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="sidebar-section">
                            <!-- Top Uploaders Sidebar (replaces Giới thiệu) -->
                            <div class="sidebar-card">
                                <h3 class="sidebar-title">
                                    <i class="fas fa-trophy me-2"></i>
                                    Người chia sẻ hàng đầu
                                </h3>
                                <ul class="list-group list-group-flush" th:if="${users != null and !#lists.isEmpty(users)}">
                                    <li class="list-group-item d-flex align-items-center justify-content-between"
                                        th:each="u, stat : ${users}">
                                        <div class="d-flex align-items-center">
                                            <span class="badge rounded-pill me-2"
                                                  th:classappend="${stat.index < 3} ? 'bg-warning text-dark' : 'bg-secondary'"
                                                  th:text="${stat.index + 1}">1</span>
                                            <div>
                                                <div class="fw-semibold" th:text="${u.fullname != null ? u.fullname : u.username}">Tên người dùng</div>
                                            </div>
                                        </div>
                                        <div class="text-nowrap">
                                            <i class="fas fa-file-upload me-1"></i>
                                            <span th:text="${u.uploadFiles != null ? #lists.size(u.uploadFiles) : 0}">0</span>
                                        </div>
                                    </li>
                                </ul>
                                <p class="text-muted text-center mb-0" th:if="${users == null or #lists.isEmpty(users)}">Chưa có dữ liệu xếp hạng</p>
                            </div>

                            <div class="sidebar-card">
                                <h3 class="sidebar-title">
                                    <i class="fas fa-link me-2"></i>
                                    Thao tác nhanh
                                </h3>
                                <div class="d-grid gap-2">
                                    <a th:href="@{/search}" class="btn btn-outline-primary">
                                        <i class="fas fa-search me-2"></i>Tìm kiếm tài liệu
                                    </a>
                                    <a th:href="@{/document/upload}" class="btn btn-outline-warning">
                                        <i class="fas fa-plus me-2"></i>Tạo tài liệu mới
                                    </a>
                                    <a th:href="@{/favorites}" class="btn btn-outline-info">
                                        <i class="fas fa-heart me-2"></i>Tài liệu yêu thích
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <div th:replace="~{base/footer :: footer}"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/script/base/base.js}"></script>
    <script th:src="@{/script/base/footer.js}"></script>
    <script th:src="@{/script/home/home.js}"></script>

    <script>
    // Auto-hide toast notifications after 5 seconds
    document.addEventListener('DOMContentLoaded', function() {
        const toasts = document.querySelectorAll('.toast');
        toasts.forEach(function(toast) {
            setTimeout(function() {
                toast.classList.add('hide');
                setTimeout(function() {
                    toast.remove();
                }, 300);
            }, 5000);
        });
    });
    </script>
</body>
</html>
